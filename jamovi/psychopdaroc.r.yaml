---
name: psychopdaroc
title: ROC Analysis
jrs: '1.1'

items:
    # ==========================================
    # INTRODUCTION AND GUIDANCE
    # ==========================================
    - name: instructions
      type: Html
      visible: true

    - name: procedureNotes
      type: Html

    # ==========================================
    # SUMMARY RESULTS - Most important information first
    # ==========================================
    - name: simpleResultsTable
      title: ROC Analysis Summary
      type: Table
      visible: true
      columns:
        - name: variable
          title: Variable
          type: text
        - name: auc
          title: AUC
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    # ==========================================
    # OPTIMAL CUTPOINTS AND DETAILED RESULTS
    # ==========================================
    - name: resultsTable
      refs: 
        - cutpointr
        - pROC
      title: Optimal Cutpoints and Performance
      type: Array
      visible: true
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - allObserved
        - specifyCutScore
        - metric
        - boot_runs
        - break_ties
        - tol_metric
        - direction
        - positiveClass
      template:
        type: Table
        rows: 0
        columns:
          - name: cutpoint
            title: Cutpoint
            type: number
          - name: sensitivity
            title: 'Sensitivity (%)'
            type: number
            format: pc
          - name: specificity
            title: 'Specificity (%)'
            type: number
            format: pc
          - name: ppv
            title: 'PPV (%)'
            type: number
            format: pc
          - name: npv
            title: 'NPV (%)'
            type: number
            format: pc
          - name: youden
            title: Youden's index
            type: number
          - name: AUC
            title: AUC
            type: number
          - name: metricValue
            title: Metric Score
            type: number

    - name: thresholdTable
      title: Detailed Threshold Performance
      type: Table
      visible: (showThresholdTable)
      columns:
        - name: threshold
          title: Cut-off
          type: number
        - name: sensitivity
          title: Sensitivity
          type: number
          format: pc
        - name: specificity
          title: Specificity
          type: number
          format: pc
        - name: accuracy
          title: Accuracy
          type: number
          format: pc
        - name: ppv
          title: PPV
          type: number
          format: pc
        - name: npv
          title: NPV
          type: number
          format: pc
        - name: plr
          title: +LR
          type: number
        - name: nlr
          title: -LR
          type: number
        - name: youden
          title: Youden's J
          type: number

    - name: sensSpecTable
      title: Sensitivity & Specificity Tables
      type: Array
      visible: (sensSpecTable)
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - allObserved
        - specifyCutScore
        - metric
        - boot_runs
        - break_ties
        - tol_metric
        - direction
        - positiveClass
      template:
        type: Html

    # ==========================================
    # AUC COMPARISON AND DELONG TEST
    # ==========================================
    - name: aucSummaryTable
      title: Area Under the ROC Curve
      type: Table
      visible: true
      columns:
        - name: variable
          title: Variable
          type: text
        - name: auc
          title: AUC
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    - name: delongComparisonTable
      title: DeLong Test Pairwise Comparisons
      type: Table
      visible: (delongTest)
      clearWith:
        - dependentVars
        - classVar
        - positiveClass
      columns:
        - name: comparison
          title: Comparison
          type: text
        - name: auc_diff
          title: AUC Difference
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: z
          title: Z-statistic
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    - name: delongTest
      title: DeLong Test Details
      type: Preformatted
      visible: (delongTest)
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - allObserved
        - specifyCutScore
        - metric
        - boot_runs
        - break_ties
        - tol_metric
        - direction
        - positiveClass

    # ==========================================
    # VISUALIZATIONS - Group all plots together
    # ==========================================
    - name: plotROC
      type: Array
      title: ROC Curves
      template:
        type: Image
        width: 550
        height: 450
        renderFun: .plotROC
        visible: (plotROC)

    - name: interactivePlot
      title: Interactive ROC Plot
      type: Image
      width: 650
      height: 500
      renderFun: .plotInteractiveROC
      visible: (interactiveROC)
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - metric
        - direction
        - positiveClass
      refs: 
        - plotROC

    - name: criterionPlot
      title: Sensitivity/Specificity vs. Threshold
      type: Array
      template:
        title: $key
        type: Image
        width: 600
        height: 400
        renderFun: .plotCriterion
        requiresData: true
      visible: (showCriterionPlot)
      clearWith:
        - method
        - metric
        - direction
        - allObserved
        - break_ties
        - tol_metric
        - boot_runs

    - name: prevalencePlot
      title: Predictive Values vs. Prevalence
      type: Array
      template:
        title: $key
        type: Image
        width: 600
        height: 400
        renderFun: .plotPrevalence
        requiresData: true
      visible: (showPrevalencePlot)
      clearWith:
        - method
        - metric
        - direction
        - allObserved
        - break_ties
        - tol_metric
        - boot_runs

    - name: dotPlot
      title: Test Values Distribution
      type: Array
      template:
        title: $key
        type: Image
        width: 600
        height: 400
        renderFun: .plotDot
        requiresData: true
      visible: (showDotPlot)
      clearWith:
        - method
        - metric
        - direction
        - allObserved
        - break_ties
        - tol_metric
        - boot_runs

    - name: dotPlotMessage
      title: Dot Plot Note
      type: Html
      visible: (showDotPlot && combinePlots)


    - name: idiTable
      title: "Integrated Discrimination Improvement (IDI)"
      type: Table
      visible: (calculateIDI)
      clearWith:
        - dependentVars
        - classVar
        - refVar
        - idiNriBootRuns
      columns:
        - name: variable
          title: Variable
          type: text
        - name: refVar
          title: Reference
          type: text
        - name: idi
          title: IDI
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    - name: nriTable
      title: "Net Reclassification Index (NRI)"
      type: Table
      visible: (calculateNRI)
      clearWith:
        - dependentVars
        - classVar
        - refVar
        - nriThresholds
        - idiNriBootRuns
      columns:
        - name: variable
          title: Variable
          type: text
        - name: refVar
          title: Reference
          type: text
        - name: nri
          title: NRI
          type: number
        - name: event_nri
          title: Event NRI
          type: number
        - name: non_event_nri
          title: Non-Event NRI
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue



    - name: partialAUCTable
      title: Partial AUC Results
      type: Table
      visible: (partialAUC)
      columns:
        - name: variable
          title: Variable
          type: text
        - name: pAUC
          title: Partial AUC
          type: number
        - name: pAUC_normalized
          title: Normalized pAUC
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: spec_range
          title: Specificity Range
          type: text

    - name: bootstrapCITable
      title: Bootstrap Confidence Intervals
      type: Table
      visible: (bootstrapCI)
      columns:
        - name: variable
          title: Variable
          type: text
        - name: parameter
          title: Parameter
          type: text
        - name: estimate
          title: Estimate
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number



# Add to the psychopdaroc.r.yaml file
    - name: rocComparisonTable
      title: Classifier Performance Comparison
      type: Table
      visible: (compareClassifiers)
      columns:
        - name: variable
          title: Variable
          type: text
        - name: auc
          title: AUC
          type: number
        - name: auprc
          title: AUPRC
          type: number
        - name: brier
          title: Brier Score
          type: number
        - name: f1_score
          title: F1 Score
          type: number
        - name: accuracy
          title: Accuracy
          type: number
        - name: balanced_accuracy
          title: Balanced Accuracy
          type: number

    - name: precisionRecallPlot
      type: Array
      title: Precision-Recall Curves
      visible: (precisionRecallCurve)
      template:
        type: Image
        width: 550
        height: 450
        renderFun: .plotPrecisionRecall




refs:
    - cutpointr
    - pROC
    - MASS
...