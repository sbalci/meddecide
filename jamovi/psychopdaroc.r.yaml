---
name: psychopdaroc
title: ROC Analysis
jrs: '1.1'

items:
    # ==========================================
    # INSTRUCTIONS AND GUIDANCE
    # ==========================================
    - name: instructions
      title: Instructions
      type: Html
      visible: true

    - name: procedureNotes
      title: Analysis Summary
      type: Html
      visible: true

    # ==========================================
    # PRIMARY RESULTS - AUC AND PERFORMANCE SUMMARY
    # ==========================================
    - name: aucSummaryTable
      title: ROC Analysis Summary
      type: Table
      visible: true
      clearWith:
        - dependentVars
        - classVar
        - positiveClass
        - subGroup
      columns:
        - name: variable
          title: Test Variable
          type: text
        - name: auc
          title: AUC
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    # ==========================================
    # OPTIMAL CUTPOINTS AND DETAILED PERFORMANCE
    # ==========================================
    - name: resultsTable
      title: Optimal Cutpoints and Performance Metrics
      type: Array
      visible: true
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - allObserved
        - specifyCutScore
        - metric
        - direction
        - positiveClass
      template:
        type: Table
        rows: 0
        columns:
          - name: cutpoint
            title: Cutpoint
            type: number
          - name: sensitivity
            title: Sensitivity (%)
            type: number
            format: pc
          - name: specificity
            title: Specificity (%)
            type: number
            format: pc
          - name: ppv
            title: PPV (%)
            type: number
            format: pc
          - name: npv
            title: NPV (%)
            type: number
            format: pc
          - name: youden
            title: Youden's Index
            type: number
          - name: AUC
            title: AUC
            type: number
          - name: metricValue
            title: Metric Score
            type: number

    # ==========================================
    # DETAILED THRESHOLD ANALYSIS
    # ==========================================
    - name: thresholdTable
      title: Performance Across Multiple Thresholds
      type: Table
      visible: (showThresholdTable)
      clearWith:
        - dependentVars
        - classVar
        - method
        - metric
        - direction
        - positiveClass
      columns:
        - name: threshold
          title: Threshold
          type: number
        - name: sensitivity
          title: Sensitivity
          type: number
          format: pc
        - name: specificity
          title: Specificity
          type: number
          format: pc
        - name: accuracy
          title: Accuracy
          type: number
          format: pc
        - name: ppv
          title: PPV
          type: number
          format: pc
        - name: npv
          title: NPV
          type: number
          format: pc
        - name: plr
          title: +LR
          type: number
        - name: nlr
          title: -LR
          type: number
        - name: youden
          title: Youden's J
          type: number

    # ==========================================
    # CONFUSION MATRICES (OPTIONAL DETAILED TABLES)
    # ==========================================
    - name: sensSpecTable
      title: Detailed Confusion Matrices
      type: Array
      visible: (sensSpecTable)
      clearWith:
        - dependentVars
        - classVar
        - subGroup
        - method
        - allObserved
        - specifyCutScore
        - metric
        - direction
        - positiveClass
      template:
        type: Html
        description: HTML-formatted confusion matrix showing TP, FP, TN, FN counts

    # ==========================================
    # STATISTICAL COMPARISONS
    # ==========================================
    - name: delongComparisonTable
      title: DeLong Test - Pairwise AUC Comparisons
      type: Table
      visible: (delongTest)
      clearWith:
        - dependentVars
        - classVar
        - positiveClass
      columns:
        - name: comparison
          title: Comparison
          type: text
        - name: auc_diff
          title: AUC Difference
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: z
          title: Z-statistic
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    - name: delongTest
      title: DeLong Test - Detailed Results
      type: Preformatted
      visible: (delongTest)
      clearWith:
        - dependentVars
        - classVar
        - positiveClass

    # ==========================================
    # MODEL IMPROVEMENT INDICES
    # ==========================================
    - name: idiTable
      title: Integrated Discrimination Improvement (IDI)
      type: Table
      visible: (calculateIDI)
      clearWith:
        - dependentVars
        - classVar
        - refVar
        - idiNriBootRuns
      columns:
        - name: variable
          title: Test Variable
          type: text
        - name: refVar
          title: Reference Variable
          type: text
        - name: idi
          title: IDI
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    - name: nriTable
      title: Net Reclassification Index (NRI)
      type: Table
      visible: (calculateNRI)
      clearWith:
        - dependentVars
        - classVar
        - refVar
        - nriThresholds
        - idiNriBootRuns
      columns:
        - name: variable
          title: Test Variable
          type: text
        - name: refVar
          title: Reference Variable
          type: text
        - name: nri
          title: Overall NRI
          type: number
        - name: event_nri
          title: Event NRI
          type: number
        - name: non_event_nri
          title: Non-Event NRI
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: p
          title: p-value
          type: number
          format: zto,pvalue

    # ==========================================
    # ADVANCED STATISTICAL ANALYSES
    # ==========================================
    - name: partialAUCTable
      title: Partial AUC Analysis
      type: Table
      visible: (partialAUC)
      clearWith:
        - dependentVars
        - classVar
        - partialAUCfrom
        - partialAUCto
      columns:
        - name: variable
          title: Variable
          type: text
        - name: pAUC
          title: Partial AUC
          type: number
        - name: pAUC_normalized
          title: Normalized pAUC
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number
        - name: spec_range
          title: Specificity Range
          type: text

    - name: bootstrapCITable
      title: Bootstrap Confidence Intervals
      type: Table
      visible: (bootstrapCI)
      clearWith:
        - dependentVars
        - classVar
        - bootstrapReps
      columns:
        - name: variable
          title: Variable
          type: text
        - name: parameter
          title: Parameter
          type: text
        - name: estimate
          title: Estimate
          type: number
        - name: ci_lower
          title: 95% CI Lower
          type: number
        - name: ci_upper
          title: 95% CI Upper
          type: number

    - name: rocComparisonTable
      title: Comprehensive Classifier Performance Comparison
      type: Table
      visible: (compareClassifiers)
      clearWith:
        - dependentVars
        - classVar
        - positiveClass
      columns:
        - name: variable
          title: Test Variable
          type: text
        - name: auc
          title: AUC
          type: number
        - name: auprc
          title: AUPRC
          type: number
        - name: brier
          title: Brier Score
          type: number
        - name: f1_score
          title: F1 Score
          type: number
        - name: accuracy
          title: Accuracy
          type: number
        - name: balanced_accuracy
          title: Balanced Accuracy
          type: number

    # ==========================================
    # VISUALIZATIONS
    # ==========================================
    - name: plotROC
      title: ROC Curves
      type: Array
      visible: (plotROC)
      clearWith:
        - dependentVars
        - classVar
        - combinePlots
        - showOptimalPoint
        - cleanPlot
      template:
        type: Image
        width: 600
        height: 500
        renderFun: .plotROC
        requiresData: true
        description: ROC curve showing sensitivity vs (1-specificity)

    - name: criterionPlot
      title: Sensitivity and Specificity vs Threshold
      type: Array
      visible: (showCriterionPlot)
      clearWith:
        - dependentVars
        - classVar
        - method
        - metric
        - direction
      template:
        type: Image
        width: 600
        height: 450
        renderFun: .plotCriterion
        requiresData: true
        description: Plot showing how sensitivity and specificity change with threshold values

    - name: prevalencePlot
      title: Predictive Values vs Disease Prevalence
      type: Array
      visible: (showPrevalencePlot)
      clearWith:
        - dependentVars
        - classVar
        - method
        - metric
      template:
        type: Image
        width: 600
        height: 450
        renderFun: .plotPrevalence
        requiresData: true
        description: Plot showing how PPV and NPV change with disease prevalence

    - name: dotPlot
      title: Test Value Distribution by True Classification
      type: Array
      visible: (showDotPlot)
      clearWith:
        - dependentVars
        - classVar
        - method
        - metric
      template:
        type: Image
        width: 600
        height: 450
        renderFun: .plotDot
        requiresData: true
        description: Distribution of test values by true classification status

    - name: precisionRecallPlot
      title: Precision-Recall Curves
      type: Array
      visible: (precisionRecallCurve)
      clearWith:
        - dependentVars
        - classVar
        - combinePlots
      template:
        type: Image
        width: 600
        height: 500
        renderFun: .plotPrecisionRecall
        requiresData: true
        description: Precision-recall curve (especially useful for imbalanced data)

    # ==========================================
    # INFORMATIONAL MESSAGES
    # ==========================================
    - name: dotPlotMessage
      title: Multiple Plot Information
      type: Html
      visible: (showDotPlot && combinePlots)


# ==========================================
# REFERENCES
# ==========================================
refs:
    - cutpointr
    - pROC
    - MASS
    - plotROC
    - boot
    - epiR

...
